## Concept set for LegendHtnStepCare

## Target drugs
ACEI <- c(1335471,1340128,1341927,1363749,1308216,1310756,1373225,1331235,1334456,1342439)
ARB <- c(1351557,1346686,1347384,1367500,40226742,1317640,1308842,40235485)
dCCB <- c(1318137,1318853,1319880,1326012,1332418,1353776)
ndCCB <- c(1307863,1328165)
Thiazide <- c(1395058,974166,978555,907013)
BB <- c(1307046,1314002,1314577,1319998,1322081,1327978,1338005,1345858,1346823,1353766,1386957, 1313200)

## Concept sets to define cohorts
antihypertensive <- c(904542,907013,932745,942350,956874,970250,974166,978555,991382,1305447,1307046,1307863,
                                      1308216,1308842,1309068,1309799,1310756,1313200,1314002,1314577,1317640,1317967,1318137,
                                      1318853,1319880,1319998,1322081,1326012,1327978,1328165,1331235,1332418,1334456,1335471,
                                      1338005,1340128,1341238,1341927,1342439,1344965,1345858,1346686,1346823,1347384,1350489,
                                      1351557,1353766,1353776,1363053,1363749,1367500,1373225,1373928,1386957,1395058,1398937,
                                      40226742,40235485)

singlePillCombi <- c(36236948,36236949,36234201,36234200,36234454,36234455,36235144,36235145,36237459,36237460,36228123,36228124,36237783,
                 36237784,36230422,36230423,36237852,36237853,36237869,36237870,36237230,36237231,36228734,36228735,36228737,36228738,
                 36228739,36228740,36232387,36232388,36218517,36218518,36233813,36233814,36234627,36234628,36231600,36231601,36231237,
                 36231238,36232591,36232592,36239382,36239383,36239801,36239802,36231925,36231926,36231927,36231928,36238820,36238819,
                 36248705,36248706,36228868,36228869,36240204,36240205,36232208,36232209,36232516,36232517,36232520,36232521,36229025,
                 36229026,36229027,36229028,36229223,36229222,36230655,36230656,36230668,36230669,36247927,36247928,36229633,36243282,
                 36243283,36243284,36241277,36241278,36230802,36232453,36232483,36232484,36227929,36227930,36229579,36231207,36231208,
                 36239102,36238510,36242839,36242838,36243159,36243160,36241084,36241085,36241087,36241088,36239296,36239297,36239983,
                 36239984,36239006,36239007,36239639,36239638,36239650,36239651,36216899,36216900,36216901,36216902,36216903,36216904,
                 36219590,36221767,36221768,36221769,36221770,36222006,36222007,36222008,36215127,36215128,36216161,36216162,36216163,
                 36216164,36216165,36216166,36216167,36216168,36216169,36216170,36216171,36216172,36216173,36216174,36216175,36216176,
                 36216246,36216247,36216248,36216249,36216250,36216251,36216252,36217712,36217713,36217714,36217715,36217708,36217709,
                 36217710,36217711,36217716,36217717,36248703,36248704,36217718,36217719,36217720,36217721,36214477,36214478,36214479,
                 36214480,36214481,36214482,36214483,36214484,36238273,36238274,36225635,36225636,36213274,36213275,36213278,36213279,
                 36217664,36217665,36217670,36217671,36223654,36223655,36212160,36215809,36215810,36217844,36217845,36217842,36217843,
                 36219628,36222040,36215393,36215394,36212261,36212262,36212400,36212401,36212293,36212294,36212295,36212296,36212297,
                 36212298,36212299,36212300,36212301,36212302,36212303,36212304,36216551,36216552,36217139,36217140,36217137,36217138,
                 36212440,36212441,36215416,36215417,36215209,36215210,36215223,36215224,36216030,36216031,36216034,36216035,36216725,
                 36216726,36216727,36216728,36224573,36224574,36224575,36224576,36225790,36225791,36226052,36226053,36226137,36226138,
                 36226139,36226140,36224600,36224601,36225434,36225435,36225438,36225439,36225436,36225437,36225440,36225441,36225442,
                 36225443,36224449,36224450,36227481,36227482,36227483,36227484,36227485,36227486,36227487,36227488,36227489,36227490,
                 36225136,36225137,36224289,36224290,36224291,36224292,36224293,36224294,36224295,36224296,36225138,36218311,36224297,
                 36224298,36224299,36224300,36218312,36218313,36218314,36218315,36224301,36224302,36224303,36224304,36224305,36224306,
                 36218316,36218317,36224307,36224308,36224309,36224310,36224311,36224312,36224313,36224314,36218318,36218319,36224315,
                 36224316,36224317,36224318,36224319,36224320,36218320,36218321,36225134,36225135,36218404,36218405,36220835,36220836,
                 36214315,36214316,36224719,36224720,36226979,36226980,36226981,36226982,36218624,36218625,36221077,36221078,36221081,
                 36221082,36250179,36250180,36224690,36224691,36221405,36221406,36226883,36226884,36220155,36220156,36227399,36227400,
                 36219017,36219018,36248677,36248678,36225488,36225489,36223174,36223175,1510704,1510705,
                 2064627,21035025,21052206,21071954,21071955,21130571,21132694,21152528,21152932,35146103,35150194,35406763,35408893,
                 36259265,36264366,36264394,36266935,36269479,36272027,36272030,36274581,36274595,36784817,36786066,36787123,36787465,
                 36881813,36889540,40003426,40007368,40007369,40007373,40007374,40007377,40007378,40007379,40007380,40010558,40010559,
                 40010560,40010561,40010567,40010568,40010569,40011854,40011855,40011856,40011860,40015092,40020436,40026132,40027598,
                 40028109,40028110,40030840,40030842,40030843,40030844,40030845,40033922,40034892,40037280,40037281,40039294,40039680,
                 40039681,40039682,40039683,40044449,40044821,40044824,40044831,40044832,40044834,40044837,40044838,40044839,40044851,
                 40044854,40044856,40044857,40045116,40045118,40045119,40045121,40045124,40045126,40045128,40049453,40054917,40054918,
                 40059139,40060227,40061782,40065740,40085584,40095410,40096153,40096806,40099414,40099416,40137849,40140541,40142669,
                 40147525,40160338,40167838,40224153,40232328,40749849,40830512,40830513,40893011,40924218,40924457,40955187,40955683,
                 40986248,40986369,40986688,41017227,41048702,41080575,41111670,41143011,41143341,41174430,41174481,41205367,41205620,
                 41236870,41237790,41238954,41267737,41298388,41298962,41299800,42479214,42705336,42874880,42875928,42938519,42948657,
                 42950872,42960011,42960024,42972643,43022805,43134832,43156974,43157075,43166576,43167787,43178952,43188587,43189757,
                 43189944,43193525,43199873,43199916,43203499,43205563,43211738,43260913,43585468,43599922,43636119,43672256,43677126,
                 43725912,43748731,43749671,43839612,44031088,44031476,44057083,44069972,44082841,44095788,45892980)

hypertension <- c(320128)
hypertensionExclude <- c(4215640, 4034031, 4083723, 4302591)

cerebralInfarction <- c(443454)
otherStroke <- c(372924, 375557, 376713, 441874, 439847, 432923)

myocardialInfarction <- c(4329847)
oldMI <- c(314666)
heartFailure <- c(316139)
rheumaticHF <- c(315295)


## Create concpetDefinition.csv

conceptDefinition = data.frame(group = rep('Antihypertensive', length(antihypertensive)), CONCEPT_ID = antihypertensive)
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Single Pill Combination', length(singlePillCombi)),CONCEPT_ID = singlePillCombi))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Hypertension', length(hypertension)),CONCEPT_ID = hypertension))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Hypertension Exclude', length(hypertensionExclude)),CONCEPT_ID = hypertensionExclude))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Cerebral Infarction', length(cerebralInfarction)),CONCEPT_ID = cerebralInfarction))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Other Stroke', length(otherStroke)),CONCEPT_ID = otherStroke))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Myocardial Infarction', length(myocardialInfarction)),CONCEPT_ID = myocardialInfarction))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Old MI', length(oldMI)),CONCEPT_ID = oldMI))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Heart Failure', length(heartFailure)),CONCEPT_ID = heartFailure))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Rheumatic HF', length(rheumaticHF)),CONCEPT_ID = rheumaticHF))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('ACEI', length(ACEI)),CONCEPT_ID = ACEI))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('ARB', length(ARB)),CONCEPT_ID = ARB))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('dCCB', length(dCCB)),CONCEPT_ID = dCCB))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('ndCCB', length(ndCCB)),CONCEPT_ID = ndCCB))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('Thiazide', length(Thiazide)),CONCEPT_ID = Thiazide))
conceptDefinition = rbind(conceptDefinition, data.frame(group = rep('BB', length(BB)),CONCEPT_ID = BB))

# connectionDetails <- DatabaseConnector::createConnectionDetails(dbms = 'myDbms',
#                                               server = 'myServer')
# 
#  connection = DatabaseConnector::connect(connectionDetails)
#  cdm_database_schema = 'myCdm'
# 
#  sql = 'select concept_id, concept_name, concept_code, domain_id, vocabulary_id, concept_class_id, standard_concept, invalid_reason from @vocabulary_database_schema.concept where concept_id in (@concept_ids)'
#  sql = SqlRender::render(sql,
#                          vocabulary_database_schema = cdm_database_schema,
#                          concept_ids = conceptDefinition$CONCEPT_ID %>% paste(collapse = ','))
#  conceptDetails <- DatabaseConnector::querySql(connection, sql, snakeCaseToCamelCase = F)
# 
#  conceptDefinition = merge(conceptDefinition, conceptDetails, all.x = T, by.x = 'CONCEPT_ID', by.y = 'CONCEPT_ID')
#  write.csv(conceptDefinition, file = file.path(getwd(), 'inst/settings/ConceptDefinition.csv'), row.names = F)



