# Rationale and Background

Over 100 million US adults have hypertension, a leading cause of mortality and morbidity, and 70% of them cannot achieve adequate blood pressure control with monotherapy alone[@RN26]. 
Although recent clinical practice guidelines suggest initiating therapy with two drugs[@Mancia2023; @Unger2020; @Whelton2018], more than 50% of people currently treated for hypertension start with a single medication [@Hripcsak2016; @Lu2022].
For these patients, clinical guidelines propose adding a second antihypertensive drug for treatment escalation[@Whelton2018; @Hripcsak2016; @Lu2022; @James2014].
However, the guidelines provide little guidance on which specific agents to add for which patients. There are no large randomized controlled trials (RCT) to guide recommendations about the choice of the second drug[@Whelton2018;]. 
RCTs comparing antihypertensive drugs are not only expensive and time-consuming, but also cannot possibly test all the relevant drug combinations recommended by the guidelines. 
Given the abundance of potential strategies, there is a critical need to generate real-world evidence to guide the choice of comparators in future RCTs and to support guideline recommendations. 
Advances in observational research design using real-world data provides an opportunity to produce high-quality evidence through strategies that support causal inference, enhance generalizability, and minimize bias. 
While this evidence will not supersede RCT evidence, it can identify promising directions for trials and provide Level of Evidence B for guideline recommendations[@Sheldrick2023]. 
Such research can be purposeful, pre-specified, and have strategies to prevent publication bias, p-hacking, and findings due to chance. 
In our prior work, we have successfully demonstrated how these methods can be applied to evaluate the effectiveness and safety of first-line antihypertensive monotherapies[@Anand2024; @You2021; @Chen2021; @Hripcsak2020; @Suchard2019]. 
This will be the first study that applies these massive real-world datasets and reproducible methods to comprehensively evaluate the effectiveness and safety of the second antihypertensive agents added to monotherapy as a hypertension stepped care.


# Study Objectives

Our long-term goal is to produce real-world evidence to inform decisions about RCTs for hypertension treatment escalation and to provide the highest quality non-randomized evidence to support guideline recommendations. 
The approach is distinctive because of the breadth and depth of data, and the use of state-of-the-art observational research methods to produce high-quality evidence. 
The overall objective in this protocol is to determine the comparative effectiveness and safety of the stepped care strategy in real-world settings. The central hypothesis is that there is heterogeneity in the effectiveness and safety of the secondary antihypertensive agent, and the optimal choice depends on patient characteristics and the initial therapy. 
Our preliminary data demonstrate a large variation in prescription patterns of the second agents added to monotherapy[@Lu2022], providing ample opportunity to leverage practice variation to test our hypothesis. The following three specific aims are proposed:

1. To determine the comparative effectiveness of the stepped-care strategy on major cardiovascular outcomes (e.g., myocardial infarction, stroke, heart failure). 
2. To determine the comparative risk of the second antihypertensive agents on potential drug-related adverse events (e.g., acute renal failure, angioedema, gastrointestinal bleeding, hyperkalemia). 
3. To assess heterogeneity in effectiveness and safety of the stepped care strategy among key patient subgroups defined by age, sex, race, ethnicity, and comorbidity.


# Research Methods

LEGEND-HTNStepCare will execute three systematic, large-scale observational studies of second line HTN agents to estimate the relative risks of cardiovascular effectiveness and safety outcomes.

1. The **Class-vs-Class Study** will provide all pairwise comparisons between the stepped care combination with four major antihypertensive agent classes to evaluate their comparative effects on cardiovascular risk (Objective 1) and patient-centered safety outcomes (Objective 2);
2.	The **Drug-vs-Drug Study** will furnish head-to-head pairwise comparisons between individual agents within and across class in stepped care combination (both Objectives 1 and 2); and
3.	The **Heterogeneity Study** will refine these comparisons for hypertension patients for important subgroups (Objective 3). 

In contrast to a single comparison approach, LEGEND-HTNStepCare will provide a comprehensive view of the findings and their consistency across populations, drugs, and outcomes. We will model each study on our successful collaborative research evaluating the comparative effectiveness of antihypertensives monotherapy previously published in The Lancet [@Suchard2019].

Table \@ref(tab:drug-table) list the four major classes of antihypertensive agents and those ingredients lisenced in the U.S. within each class.

For each comparison, we are interested in the relative risk of each of the cardiovascular and safety outcomes described in Section \@ref(outcomes).
<!-- listed in Table \@ref(tab:outcome-table). -->

<!-- Acute pancreatitis -->
<!-- Cancer -->
<!--             Bladder -->
<!--             Renal -->
<!--             Breast -->
<!-- Photosensitivity -->
<!-- DKA -->
<!-- Amputation -->
<!-- Fracture: -->
<!--             All -->
<!--             Fracture-related -->
<!-- VTE -->
<!-- Infection of male genitalia -->
<!-- Hypovolemia or dehydration -->
<!-- Hepatic injury -->
<!-- Hyperkalemia -->
<!-- Mycotic genital infection (women) -->
<!-- Severe hypersensitivity -->
<!-- ?cutaneous reaction -->
<!-- Progression of albuminuria (an efficacy outcome based on labs other than renal function) -->

```{r drug-table, echo=FALSE}
exposures <- read.csv(system.file("settings/ExposuresOfInterest.csv", package = "LegendHtnStepCare"))
classes <- exposures %>% filter(type == "Drug") %>% select(class) %>% pull() %>% unique()
tmp <- sapply(classes, function(single_class) {
  as.vector(exposures %>% filter(type == "Drug", class == single_class) %>% select(name) %>% pull())
})

n.obs <- sapply(tmp, length)
seq.max <- seq_len(max(n.obs))
drugs_by_class <- data.frame(sapply(tmp, "[", i = seq.max))
names(drugs_by_class) <- c("ACEI", "ARB", "dCCB", "ndCCB", "Thiazide", "BB")

tab <- kable(drugs_by_class, booktabs = TRUE, linesep = "",
             caption = "Antihypertensive drug classes and individual agents within each class") %>%
  kableExtra::kable_styling(bootstrap_options = "striped", latex_options = c("striped","hold_position"))

if (knitr::is_latex_output()) {
  tab %>%
    column_spec(1, width = "8em") %>%
    column_spec(2, width = "8em") %>%
    column_spec(3, width = "8em") %>%
    column_spec(4, width = "8em") %>%
    kable_styling(font_size = latex_table_font_size)
} else {
  tab
}
```

## Study Design

For each study, we will employ an active comparator, new-user cohort design.(14) 
New-user cohort design is advocated as the primary design to be considered for comparative effectiveness and drug safety. 
By identifying patients who start a new treatment course and using therapy initiation as the start of follow-up, the new-user design models a randomized controlled trial (RCT) where treatment commences at the index study visit.
Exploiting such an index date allows a clear separation of baseline patient characteristics that occur prior to index date and are usable as covariates in the analysis without concern of inadvertently introducing mediator variables that arise between exposure and outcome.
Excluding prevalent users as those without a sufficient washout period prior to first exposure occurrence further reduces bias due to balancing mediators on the causal pathway, time-varying hazards, and depletion of susceptibles. 
Our systematic framework across studies further will address residual confounding, publication bias, and p-hacking using data-driven, large-scale propensity adjustment for measured confounding, a large set of negative control outcome experiments to address unmeasured and systematic bias, and full disclosure of hypotheses tested. 
Figure 8.1 illustrates our design for all studies that the following sections describe in more detail.

```{r study-schematic, echo=FALSE, message=FALSE, fig.align='center', fig.cap='Schematic of LEGEND-HtnStepCare new-user cohort design for the Class-vs-Class, Drug-vs-Drug and Heterogeneity studies.', fig.pos='H'}
if (knitr::is_latex_output()) knitr::include_graphics("figure1.pdf")
```

## Data Sources

We will execute LEGEND-HTNStepCare as a series of OHDSI network studies. 
All data partners within OHDSI are encouraged to participate voluntarily and can do so conveniently, because of the community’s shared Observational Medical Outcome Partnership (OMOP) common data model (CDM) and OHDSI tool-stack. 
Many OHDSI community data partners have already committed to participate and we will recruit further data partners through OHDSI’s standard recruitment process, which includes protocol publication on OHDSI’s GitHub, an announcement in OHDSI’s research forum, presentation at the weekly OHDSI all-hands-on meeting and direct requests to data holders.

In Table 8.2, we report a brief description of already committed databases and their size of the population it represents and its patient capture process and start date. While the earliest patient capture begins in 2000 (VA), the vast majority come from the 2010s to today, providing a decade of HTN treatment coverage. The US population include those publicly insured, enriched for older individuals (VA) and racially diverse (VA, Sentara). The US data sources may capture the same patients across multiple sources. Different views of the same patients are an advantage in capturing the diversity of real-world health events that patients experience. All data sources will receive institutional review board approval or exemption for their participation before executing LEGEND-HTNStepCare.

```{r data-sources, echo=FALSE, warning=FALSE}
data_sources <- readr::read_delim(col_names = TRUE, delim = ";", trim_ws = TRUE, file = "
  Data source ; Population ; Patients ; History ; Data capture process and short description
  Yale New Haven Health System (YNHHS) ; Academic medical center patients ; 2M ; 2013 -- ; General practice, specialists and inpatient hospital services from the YNHHS in Connecticut.
  Sentara Healthcare (Sentara) ; Patients in a non-profit integrated healthacare system, all ages, racially diverse ; 7.8M ; 2010 -- ; The largest integrated health system in Northern Virginia with 12 hostpials and 556 outpatient sites. Sentara Healthcare serves the Hampton Roads region of Virginia, an area with 1.7 million residents, of which 31% are African American and 8% are Hispanic.
  Department of Veterans Affairs (VA) ; Veterans, older, racially diverse ; 12M ; 2000 -- ; National VA health care system, the largest integrated provider of medical services in the US, provided at 170 VA medical centers and 1,063 outpatient sites.
  Columbia University Irving Medical Center (CIUMC) ; Academic medical center patients, racially diverse ; 6M ; 1989 -- ; General practice, specialists and inpatient hospital services from the New York-Presbyterian hospital and affiliated academic physician practices in New York.
  Optum Electronic Health Records (PanTher) ; US general Population, all ages ; 93M ; 2006 -- ; Clinical information, prescriptions, lab results, vital signs, body measurements, diagnoses and procedures derived from clinical notes using natural language processing.
", show_col_types = FALSE)
tab <- kable(data_sources, booktabs = TRUE, linesep = "",
      caption = "Committed LEGEND-HtnStepCare data sources and the populations they cover.") %>%
  kable_styling(bootstrap_options = "striped", latex_options = "striped") %>%
  pack_rows("Administrative claims", 1, 3, latex_align = "c", indent = FALSE) %>%
  pack_rows("Electronic health records (EHRs)", 4, 5, latex_align = "c", indent = FALSE)

if (knitr::is_latex_output()) {
  tab %>%
    column_spec(1, width = "10em") %>%
    column_spec(2, width = "10em") %>%
    column_spec(5, width = "25em") %>%
    kable_styling(font_size = latex_table_font_size)
} else {
  tab
}
```

## Study Population

We will include all subjects in a data source who meet inclusion criteria for the stepped care exposure cohorts. 
Broadly, these cohorts will consist of hypertension patients with any of ACEis, ARBs, THZs, and CCBs previous as a first line hypertension treatment. 
We describe specific definitions of exposure cohorts for each study in the following sections.

## Exposure Comparators

### Class-vs-Class Study comparisons {#class-v-class}
The **Class-vs-Class** Study will construct nine exposure cohorts for secondary use of any drug ingredient within the four major classes in Table 8.1. 
Cohort entry (index date) for each patient is their first observed exposure to any drug ingredient for secondary added drug classes (different to primary class). 
Consistent with an idealized target trial for hypertension therapy and cardiovascular risk, inclusion criteria for patients based on the index date will include: 

* Hypertension diagnosis but no secondary HTN diagnosis before the index date;
* At least 1 year of observation time before the index date (to improve new-user sensitivity);
* At least one prescription of first antihypertensive agents before 30 days earlier than the index date;
* No single use of antihypertensives at the index date;
* No prior drug exposure to a comparator antihypertensive agent; and
* No other antihypertensive agents (other diuretics: loop diuretics/K+ sparing diuretics/aldosterone antagonists; direct renin inhibitor; alpha-1 blocker; central alpha-2 agonist and other centrally acting drugs; direct vasodilators).

We will construct and compare separately cohorts patients either with

* At least 1 months use of first-line antihypertensive agents use before the index date.

In this case, a month of first-line antihypertensive agents is consistent with 2017 AHA/ACC guidelines. 
We purposefully do not automatically exclude or restrict to patients with first line beta-blockers, with a history of myocardial infarction, stroke or other major cardiovascular events, which will allow us to report relative effectiveness and safety for individuals with both low or moderate and high cardiovascular risk. 
Likewise, we do not automatically exclude or restrict to individuals with severe renal impairment. 
We will use cohort diagnostics, such as achieving covariate balance and clinical empirical equipoise between exposure cohorts (Section 9) and stakeholder input to guide the possible need to exclude other prior diagnoses, such as heart failure.

Of note, the inclusion criteria do not directly incorporate quantitative measures of blood pressure control, such as elevated blood pressure; such laboratory values are irregularly captured in even EHR data sources. 
The ACC/AHA guidelines advise escalating to add a second agent when average BP is more than 20/10 mmHg above their BP target. 
We will conduct sensitivity analyses involving available BP measurements to demonstrate their balance between exposure cohorts (described later in Section 9).
In the unlikely event that balance is not met, we will consider an inclusion criterion of BP > 130/80 (or 140/90) mmHg within 6 months before the index. 

For each data source, we will then execute all 12 pairwise major class comparisons for which the data source yields $\ge$ 1,000 patients in each arm (Appendix A. 1. 1).
Appendix A. 1. 2 reports the complete OHDSI ATLAS cohort description for new-users of thiazide or thiazide-like diuretics with the first line RAS acting agent. 
This description lists complete specification of cohort entry events, additional inclusion criteria, cohort exit events, and all associate standard OMOP CDM concept code sets used in the definition. 
ATLAS automatically translates these definitions into network-deployable SQL source code. 
In addition, we plan to perform 44 comparisons based on detailed classes (Appendix A. 1. 3). 
Significantly fewer numbers of patients strongly suggest data source-specific differences in prescribing practices that may introduce residual bias and sufficient sample sizes are required to construct effective propensity score models.

### Drug-vs-Drug Study comparisons {#drug-v-drug}

The **Drug-vs-Drug** Study will construct 1,216 exposure cohorts for new-users of each drug ingredient in Table 8.1. 
We will apply the same cohort definition, inclusion criteria and patient count minimum as described in Section 8.4.1. 

Theoretically, 206,048 combinations of first line antihypertensives and second add-on agents are possible. 
However, we want to take into account the fact that Class-vs-Class comparisons will be performed and clinical situation when stepped care is performed. 
Therefore, we will focus primary clinical interpretation and scientific publishing to the 6,832 comparisons where the first-line drug is the same and the second line drug is a different ingredient within the same class (Appendix 2. .1. 1).

Appendix A. 2. 2 reports the complete OHDSI ATLAS cohort description for new-users of hydrochlorothiazide added to their benazepril treatment. Again, we programmatically construct all new-user drug-level cohort and automatically translate into SQL.


### Heterogeneity Study comparisons

The **Heterogeneity Study** will further stratify all class- and drug-level exposure cohorts in Section 8.4.1 and 8.4.2 by clinically important patient characteristics that modify cardiovascular risk of relative treatment heterogeneity to provide patient-focused treatment recommendations. 
These factors will include:

* Age (18 - 44 / 45 - 64 / $\ge$ 65 at the index date)
* Sex (women / men)
* Race (African American or black)
* Heart failure 
* Type 2 diabetes mellitus
* Renal impairment

We will narrow down the patient population to major comorbidities suggested in the guideline, such as heart failure, type 2 diabetes mellitus, and renal impairment.
Heart failure and type 2 diabetes mellitus will be defined according to the diagnosis. 
Renal impairment through diagnosis codes for chronic kidney disease and end-stage renal disease, dialysis procedures, and laboratory measurements of estimated glomerular filtration rate, serum creatinine and urine albumin.

Appendix A. 3 presents complete OHDSI ATLAS specifications for these subgroups, including all standard OMOP CDM concept codes defining heart failure, diabetes, and renal impairment.

### Validation

We will validate exposure cohorts and aggregate drug utilization using comprehensive cohort characterization tools against data sources. Chief among these tools stands OHDSI’s CohortDiagnostics package (https://github.com/OHDSI/CohortDiagnostics). 
For any cohort and data source mapped to OMOP CDM, this package systematically generates incidence new-user rates (stratified by age, gender, and calendar year), cohort characteristics (all comorbidities, drug use, procedures, health utilization) and the actual codes found in the data triggering the various rules in the cohort definitions. 
This can allow researchers and stakeholders to understand the heterogeneity of source coding for exposures and health outcomes as well as the impact of various inclusion criteria on overall cohort counts (details described in Section 9).

## Outcomes {#outcomes}

We originally identified outcomes for LEGEND-HTNStepCare from clinical trial endpoints from clinical guidelines and systematic reviews. We augmented these with adverse events from US structured product labels of hypertension drugs. 
For each outcome, we developed an operational phenotype definition to determine if observational data could in fact support evaluation of the outcome. 
We used the same approach to design, implement, and evaluate all phenotypes. Specifically, clinical guidelines and systematic review of clinical trial of hypertension treatments informed our clinical definition of cardiovascular outcomes. 
We developed all exposure cohorts according to the definition itself through ATLAS. We did not perform source record verification or other validation methods.

Across all data sources and pairwise exposure cohorts, we will assess relative risks of 32 cardiovascular and patient-centered outcomes (Table 8.3). Primary outcomes of interest are: 


* 3-point major adverse cardiovascular events (MACE), including acute myocardial infarction, stroke, and sudden cardiac death, and
* 4-point MACE that additionally includes heart failure hospitalization.

Secondary outcomes include:

* individual MACE components,

In data sources with laboratory measurements, secondary outcomes further include:

* Blood pressure control

We will also study secondary antihypertensive agent adverse events and safety concerns highlighted in the 2017 ACC/AHA guidelines and from RCTs, including SPRINT trial. We will employ the same level of systematic rigor in studying outcomes regardless of their primary or secondary label. 
A majority of outcome definitions have been previously implemented and validated in our own work, based heavily on prior development by others (see references in Table 8.5). 

To assess across-source consistency and general clinical validity, we will characterize outcome incidence, stratified by age, sex and index year for each data source.

<!-- While we list many patient-centered outcomes as "exploratory" in the table, we use this term to highlight those that are less likely to achieve high statistical power across all data sources due to lower event rates. -->
We will employ the same level of systematic rigor in studying outcomes regardless of their primary or secondary label.

```{r outcome-prep, echo=FALSE, warning=FALSE}
outcomes <- read.csv(system.file("settings/OutcomesOfInterest.csv",
                                 package = "LegendHtnStepCare")) %>%
  select(atlasName,description,cite,hyperlink)

stripCitation <- function(cite) {
  if (cite != "") {
    tmp <- substring(cite, 2, nchar(cite) - 1)
    citeList <- strsplit(tmp, ";")
    #paste(unlist(citeList), collapse = ";")
    citeList
  } else {
    NULL
  }
}

citeList <- unlist(sapply(outcomes$cite, stripCitation))
names(citeList) <- NULL
citeList <- unique(citeList)
citeList <- paste("[",
                  paste(citeList, collapse = ";")
                  ,"]", collapse = "")

if (knitr::is_latex_output()) {
  convertCitationToLatex <- function(cite) {
    if (cite != "") {
      tmp <- substring(cite, 2, nchar(cite) - 1)
      citeList <- strsplit(tmp, ";")
      tmpList <- lapply(citeList, function(x) {
        substring(x, 2, nchar(x))
      })
      tags <- paste(unlist(tmpList), collapse = ",")
      cite <- paste("\\cite{", tags, "}", sep = "")
    }
    cite
  }
  outcomes$cite <- outcomes$hyperlink
}

outcomes <- outcomes %>% select(-hyperlink)
```

A majority of outcome definitions have been previously implemented and validated in our own work [@Suchard2019-gq; @You_undated-fz; @Ryan2018-ci; @Wang2017-su; @Weinstein2020-ic; @Yuan2018-am] based heavily on prior development by others (see references in Table \@ref(tab:outcome-table) `r citeList`).
To assess across-source consistency and general clinical validity, we will characterize outcome incidence, stratified by age, sex and index year for each data source.

```{r outcome-table, echo=FALSE, warning=FALSE, results='asis'}
colnames(outcomes) <- c("Phenotype", "Brief logical description", "Prior development")

tab <- kable(outcomes, booktabs = TRUE, linesep = "", escape = FALSE,
             longtable = (is.null(params$avoidLongTable) || (params$avoidLongTable == FALSE)),
      caption = "LEGEND-HtnSteppedCare study outcomes") %>%
  kable_styling(bootstrap_options = "striped", latex_options = "striped") %>%
  pack_rows("Cardiovascular outcomes", 1, 2, latex_align = "c", indent = FALSE)  %>%
  pack_rows("Patient-centered safety outcomes", 11, 12, latex_align = "c", indent = FALSE)

if (knitr::is_latex_output()) {
  tab %>%
    column_spec(2, width = "32em") %>%
    # column_spec(3, width = "10em") %>%
    kable_styling(font_size = latex_table_font_size,
                  latex_options = c("repeat_header"),
                  repeat_header_continued = "\\textit{(Continued on Next Page...)}")
} else {
  tab
}
```

## Analysis

### Contemporary utilization of drug classes and individual agents

For all cohorts in the three studies, we will describe overall utilization as well as temporal trends in the use of each drug class and agents within the class. Further, we will evaluate these trends in patient groups by age (18-44 / 45-64 / $\ge$ 65 years), sex, race and geographic regions. 
These data will provide insight into the current patterns of use ad possible disparities. These data are critical to guide the real-world application of treatment decision pathways for the treatment of HTN patients. 

Specifically, we will calculate and validate aggregate drug utilization using the OHDSI’s CohortDiagnostics package against data sources. 
The CohortDiganostics package works in two steps: 1) Generate the utilization results and diagnostics against a data source and 2) Explore the generated utilization and diagnostics in a user-friendly graphical interface R-Shiny app. 
Through the interface, one can explore patient profiles of a random sample of subjects in a cohort. 
These diagnostics provide a consistent methodology to evaluate cohort definition and phenotype algorithms across a variety of observational databases. 
This will enable researchers and stakeholders to become informed on the appropriateness of including specific data sources within analyses, exposing potential risks related to heterogeneity and variability in patient care delivery that, when not addressed in the design, could result in errors such as high correlated covariates in propensity score matching of a target and a comparator cohort. 
Thus, the added value of this approach is two-fold in terms of exposing data quality for a study question and ensuring face validity checks are performed on proposed covariates to be used for balancing propensity scores.

### Relative risk of cardiovascular and patient-centered outcomes

We will execute a systematic process to estimate the relative risk of cardiovascular and patient-centered outcomes between new-users of second-line HTN agents. 
The process will adjust for measured confounding, control from further residual (unmeasured) bias and accommodate important design choices to best emulate the nearly impossible to execute, idealized RCT that our stakeholders envision across data source populations, comparators, outcomes, and subgroups. 

To adjust for potential measured confounding and improve the balance between cohorts, we will build large-scale propensity score (PS) models for each pairwise comparison and data source using a consistent data-driven process through regularized regression. 
This process engineers a large set of predefined baseline patient characteristics, including age, gender, race, index month/year and other demographics and prior conditions, drug exposures, procedures, laboratory measurements and health service utilization behaviors, to provide the most accurate prediction of treatment and balance patient cohorts across many characteristics. 
Construction of condition, drug, procedures and observations include occurrences within 365, 180, and 30 days prior to index date and are aggregated at several SNOMED (condition) and ingredient/ATC class (drug) levels. 
Other demographic measures include comorbidity risk scores (Charlson, DCSI, CHADS2, CHAD2VASc). 
From prior work, feature counts have ranged in the 1,000s-10,000s, and these large-scale PS models have outperformed hdPS in simulation and real-world examples.

We will:

* Exclude patients who have experienced the outcome prior to their index date,
* Stratify and variable-ratio match patients by PS, and
* Use Cox proportional hazards models

to estimate hazard ratios (HRs) between alternative target and comparator treatments for the risk of each outcome in each data source.
In addition, we will perform a sensitivity analysis that does not exclude individuals who previously experienced a blood pressure control outcome before the index date.
The regression will condition on the PS strata/matching-unit with treatment allocation as the sole explanatory variable and censor patients at the end of their time-at-risk (TAR) or data source observation period.
We will prefer stratification over matching if both sufficiently balance patients (see Section \@ref(sample-size)), as the former optimizes patient inclusions and thus generalizability.

We will execute each comparison using three different TAR definitions, reflecting different and important causal contrasts:

* Intent-to-treat (TAR: index + 1 → end of observation) captures both direct treatment effects and (long-term) behavioral/treatment changes that initial assignment triggers [@Hernan2012-kz];
* On-treatment-1 (TAR: index + 1 → treatment discontinuation) is more patient-centered [@Murray2018-zf] and captures direct treatment effect while allowing for escalation with additional T2DM agents; and
* On-treatment-2 (TAR: index + 1 → discontinuation or escalation with T2DM agents) carries the least possible confounding with other concurrent T2DM agents.

Our “on-treatment” is often called “per-protocol”. Systematically executing with multiple causal contrasts enables us to identify potential biases that missing prescription data, treatment escalation and behavioral changes introduce, while preserving the ease of intent-to-treat interpretation and power if the data demonstrate them as unbiased. 
Appendix A.3 reports the modified cohort exit rule for the on-treatment-2 TAR.

We will aggregate HR estimates across non-overlapping data sources to produce meta-analytic estimates using a random-effects meta-analysis. 
The classic meta-analysis assumes that per-data source likelihoods are approximately normally distributed. 
This assumption fails when outcomes are rare as we expect for some safety events. 
Here, our recent research shows that as the number of data sources increases, the non-normality effect increases to where coverage of 95% confidence intervals (CIs) can be as low as 5%. 
To counter this, we will also apply a Bayesian meta-analysis model that neither assumes normality nor requires patient-level data sharing by building on composite likelihood methods and enables us to introduce appropriate overlap weights between data sources.

Residual study bias from unmeasured and systematic sources often remains in observational studies even after controlling for measured confounding through PS-adjustment. 
For each comparison-outcome effect, we will conduct negative control (falsification) outcome experiments, where the null hypothesis of no effect is believed to be true, using approximately 100 controls. 
We identified these controls through a data-rich algorithm that identifies prevalent OMOP condition concept occurrences that lack evidence of association with exposures in published literature, drug-product labeling and spontaneous reports, and were then adjudicated by clinical review. 
We previously validated 60 of the controls in LEGEND-HTN. Appendix C lists these negative controls and their OMOP condition concept IDs.
Using the empirical null distributions from these experiments, we will calibrate each study effect HR estimate, its 95% CI and the p-value to reject the null hypothesis of no differential effect. 
We will declare an HR as significantly different from no effect when its calibrated p < 0.05 without correcting for multiple testing. 
Finally, blinded to all trial results, study investigators will evaluate study diagnostics for all comparisons to assess if they were likely to yield unbiased estimates (Section 9).


### Sensitivity analyses and missingness

Because of the potential confounding effect of blood pressure at baseline between treatment choice and outcomes and to better understand the impact of limited blood pressure level measurements on effectiveness and safety estimation that arises in some EHR data, we will perform pre-specified sensitivity analyses for all studies within data sources that contain reliable blood pressure measurements. 
Within a study, for each exposure pair, we will first rebuild PS models where we additionally include baseline blood pressure as patient characteristics, stratify or matching patients under the new PS models that directly adjust for potential confounding by blood pressure and then estimate effectiveness and safety HRs.

A limitation of the Cox model is that no doubly robust procedure is believed to exist for estimating HRs, due to their non-collapsibility. 
Doubly robust procedures combine baseline patient characteristic-adjusted outcome and PS models to control for confounding and, in theory, remain unbiased when either (but not necessarily both) model is correctly specified. 
Doubly robust procedures do exist for hazard differences, and we will validate the appropriateness of our univariable Cox modelling by comparing estimate differences under an additive hazards model with and without doubly robust-adjustment. 
In practice, however, neither the outcome nor PS model is correctly specified, leading to systematic error in the observational setting.

Missing data of potential concern are patient demographics (gender, age, race)  for our inclusion criteria.
We will include only individuals whose baseline eligibility can be characterized that will most notably influence race subgroup assessments in the **Heterogeneity Study**.
No further missing data can arise in our large-scale PS models because all features, with the exception of demographics, simply indicate the presence or absence of health records in a given time-period.  Finally, we limit the impact of missing data, such as prescription information, relating to exposure time-at-risk by entertaining multiple definitions [@Schneeweiss2007-am].
In all reports, we will clearly tabulate numbers of missing observations and patient attrition.

# Sample Size and Study Power {#sample-size}

Within each data source, we will execute all comparisons with $\ge$ 1,000 eligible patients per arm.
Blinded to effect estimates, investigators and stakeholders will evaluate extensive study diagnostics for each comparison to assess reliability and generalizability, and only report risk estimates that pass [@Schuemie2018-zi; @Schuemie2020-wx].
These diagnostics will include

1. Minimum detectable risk ratio (MDRR) as a typical proxy for power,
2. Preference score distributions to evaluate empirical equipoise10 and population generalizability,
3. Extensive patient characteristics to evaluate cohort balance before and after PS-adjustment,
4. Negative control calibration plots to assess residual bias, and
5. Kaplan-Meier plots to examine hazard ratio proportionality assumptions.

We will define cohorts to stand in empirical equipoise if the majority of patients carry preference scores between 0.3 and 0.7 and to achieve balance if all after-adjustment characteristics return absolute standardized mean differences $<$ 0.1 [@Austin2009-af].

# Strengths and Limitations {#strengths-limitations}

## Strengths

The strengths of the LegendHtnStepCare study stem from the research question, the methodologies employed, and our commitment to open science:
*	This study is poised to be the first to systematically address the critical clinical question: What are the relative benefits and risks of adding a second antihypertensive drug to monotherapy in patients with hypertension?
* We are employing massive, diverse real-world datasets and cutting-edge observational research methods to provide comprehensive estimates of effectiveness and safety for second antihypertensive drugs added to monotherapy. These tools have previously evaluated antihypertensive monotherapies, but have not been used to assess the addition of a second drug when monotherapy is insufficient for managing hypertension.
*	Unlike typical observational research, this study will minimize residual bias by employing reproducible methods to mitigate observed confounding. We will enhance transparency by reporting diagnostics such as empirical equipoise and covariate balance, and by using a large set of control outcomes to detect and correct for any remaining systematic errors. This approach marks a significant advancement in observational research.
*	We will assess antihypertensive medications at both class and individual drug levels, evaluating effectiveness and safety across patient subgroups defined by demographic and clinical characteristics. This comprehensive approach has not been adequately explored in previous studies.
*	Our commitment to Open Science includes making all study artifacts—such as the study protocol, analytical code, and full results—publicly available. We will also provide real-time access to these materials for external analysis and interpretation, a practice that goes beyond the transparency typically seen in past studies.


## Limitations

Some additional aspects merit consideration:
*	Residual Confounding: Despite our sophisticated analytic approach and diagnostics, residual confounding remains a possibility. 
We anticipate that ongoing and future randomized controlled trials (RCTs) will shed further light on this issue. 
We will use two distinct methods to triangulate residual confounding: large-scale propensity score (PS) adjustment and the use of numerous negative controls. 
Our PS adjustment incorporates tens of thousands of baseline covariates for matching and stratification.
*	Medication Adherence: Merely having a prescription does not guarantee medication consumption. 
We will conduct sensitivity analyses using pharmacy refill data to infer adherence, and perform on-treatment analysis to adjust for potential discrepancies in adherence across different drug classes.
*	Dose Variability: We will conduct sensitivity analyses among patients maintaining consistent dosing throughout the on-treatment period to account for differences in dosing and potency.
*	Medication Indication: Some patients, like those with congestive heart failure, might be prescribed antihypertensive medications for reasons other than lowering blood pressure. 
We will exclude such patients from the study cohort during sensitivity analyses.
*	Informative Censoring: There is a risk that censoring at the end of the on-treatment periods could be informative. 
We will utilize extensive negative controls to detect and adjust for any potential bias introduced by this censoring.
*	Overlap of Patients Across Databases: While our study is designed to minimize patient overlap across databases by adhering to federated analytic principles, we acknowledge that some overlap may occur. We will ensure that patient experiences are reported distinctly for each database.


# Protection of Human Subjects

LEGEND-HTNStepCare does not involve human subject research.
The project does, however, use human data collected during routine healthcare provision.
Most often the data are de-identified within data source.
All data partners executing the LEGEND-T2DM studies within their data sources will have received institutional review board (IRB) approval or waiver for participation in accordance to their institutional governance prior to execution (see Table \@ref(tab:irb)).
LEGEND-T2DM executes across a federated and distributed data network, where analysis code is sent to participating data partners and only aggregate summary statistics are returned, with no sharing of patient-level data between organizations.

```{r irb, echo=FALSE}
data_sources <- readr::read_delim(col_names = TRUE, delim = "&", trim_ws = TRUE, file = "
Data source & Statement
Yale New Haven Health System (YNHHS) & Use of the YNHHS EHR data source was approved by the Yale University Institutional Review Board as an OHDSI network study (IRB\\# pending).
Sentara Healthcare System (Sentara) & Use of the Sentara EHR data source was approved by the Senatara Health Institutional Review Board as an OHDSI network study (IRB\\# pending).
Department of Veterans Affairs (VA) & Use of the VA EHR data source was approved by the Department of Veterans Affairs Central Institutional Review Board and was determined to meet the criteria for exemption under Exemption category4(3) and approved the request for Waiver of HIPAA Authorization (IRB\\# pending).

", show_col_types = FALSE)

tab <- kable(data_sources, booktabs = TRUE, linesep = "",
      caption = "IRB approval or waiver statement from partners.") %>%
  kable_styling(bootstrap_options = "striped", latex_options = "striped")

if (knitr::is_latex_output()) {
  tab %>%
    column_spec(1, width = "15em") %>%
    column_spec(2, width = "40em") %>%
    kable_styling(latex_options = c("striped","hold_position"), 
                  font_size = latex_table_font_size)
} else {
  tab
}
```

# Management and Reporting of Adverse Events and Adverse Reactions

LEGEND-HtnStepCare uses coded data that already exist in electronic databases.
In these types of databases, it is not usually possible to link (i.e., identify a potential causal association between) a particular product and medical event for any specific individual.
Thus, the minimum criteria for reporting an adverse event (i.e., identifiable patient, identifiable reporter, a suspect product and event) are not available and adverse events are not reportable as individual adverse event reports.
The study results will be assessed for medically important findings.

# Plans for Disseminating and Communicating Study Results

Open science aims to make scientific research, including its data process and software, and its dissemination, through publication and presentation, accessible to all levels of an inquiring society, amateur or professional [@Woelfle2011-ss] and is a governing principle of LEGEND-HtnStepCare.
Open science delivers reproducible, transparent and reliable evidence.
All aspects of LEGEND-HtnStepCare (except private patient data) will be open and we will actively encourage other interested researchers, clinicians and patients to participate.
This differs fundamentally from traditional studies that rarely open their analytic tools or share all result artifacts, and inform the community about hard-to-verify conclusions at completion.

## Transparent and re-usable research tools

We will publicly register this protocol and announce its availability for feedback from stakeholders, the OHDSI community and within clinical professional societies.
This protocol will link to open source code for all steps to generating diagnostics, effect estimates, figures and tables.
Such transparency is possible because we will construct our studies on top of the OHDSI toolstack of open source software tools that are community developed and rigorously tested [@Schuemie2020-wx].
We will publicly host LEGEND-HtnStepCare source code at (https://github.com/ohdsi-studies/LegendHtnStepCare), allowing public contribution and review, and free re-use for anyone’s future research.

## Continuous sharing of results

LEGEND-HtnStepCare embodies a new approach to generating evidence from healthcare data that overcome weaknesses in the current process of answering and publishing (or not) one question at a time.
Generating evidence for thousands of research and control questions using a systematic process enables us to not only evaluate that process and the coherence and consistency of the evidence, but also to avoid $p$-hacking and publication bias [@Schuemie2018-zi].
We will store and openly communicate all of these results as they become available using a user-friendly web-based app that serves up all descriptive statistics, study diagnostics and effect estimates for each cohort comparison and outcome.
Open access to this app will be through a general public facing LEGEND-HtnStepCare webpage.

## Scientific meetings and publications

We will deliver multiple presentations annually at scientific venues including the annual meetings of the American Diabetes Association, American College of Cardiology, American Heart Association and American Medical Informatics Association.
We will also prepare multiple scientific publications for clinical, informatics and statistical journals.

## General public

We believe in sharing our findings that will guide clinical care with the general public.
LEGEND-HtnStepCare will use social-media (Twitter) to facilitate this.
With dedicated support from the OHDSI communications specialist, we will deliver regular press releases at key project stages, distributed via the extensive media networks of UCLA, Columbia and Yale.
